## 問題 8.7 🖋️

https://www.ricoh.co.jp を開き、ロードされている js ファイル中で名前空間としての関数の即時関数実行式を使っている js ファイルを 1 つ以上見つけて URL を記載しなさい。

ヒント: ロードされている js ファイル一覧は Chrome ではデベロッパーツールを開き"ソース"タブから確認できる

## 回答

### 名前空間としての関数の即時関数実行式を使っている js ファイル

analytics.js

### URL

https://analytics.ahrefs.com/analytics.js

## その他メモ

### 1. 目的

このコードの主な目的は Webサイトのアクセスやユーザー操作を分析するトラッキング。

- ページビューやクリックイベント、フォーム送信などを記録
- エラーや例外も送信
- 外部からの衝突を避けるために、独自の名前空間 (AhrefsAnalytics など) にまとめて管理

IIFE を使うことで、グローバル変数を汚さずに内部で変数や関数を隠蔽できる。

### 2. コードの構成

ざっくり構成を分けると：

1. 即時関数の開始

```js
!(function() { ... })();
```

- 関数を定義してすぐ実行
- ! は文法的に関数を式に変えるためで、省略可能

2. ユーティリティ関数の定義

```js
var g = function(a, u){...}
var b = Object.assign || function(a){...}
```

- 配列をループしたりオブジェクトをマージしたりする小さな関数を作る

3. 環境情報の取得

```js
var y = window.location;
var l = window.document.currentScript;
```

- ページ URL、スクリプト自身の情報、属性などを取得

4. データ送信関数

```js
function J(a, u, i){ ... }
```

- XMLHttpRequest を使ってサーバーにデータ送信
- エラー時も送信できるように try/catch でラップ

5. 初期化処理

```js
f(function() { ... })
```

- ページ読み込み時や DOM 準備完了時にトラッキングのセットアップ
- 各種イベント（クリック、フォーム送信、ページ表示など）を監視

6. 名前空間の公開

```js
window[H] = { sendEvent: function(...) { ... } }
```

- グローバルに AhrefsAnalytics というオブジェクトを作り、外部から sendEvent を呼べるようにする 7. イベント監視と送信
- ページ内リンクのクリックやフォーム送信を監視
- MutationObserver で動的に追加された要素も追跡
- 収集データを JSON にしてサーバーに送信
