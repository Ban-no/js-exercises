## マイクロタスクとは？

1. タスク vs マイクロタスク

- タスク: setTimeout や setInterval のコールバック、イベントリスナーなどの通常の非同期処理。
- マイクロタスク: Promise の .then() や queueMicrotask() で登録する、より優先度の高い非同期処理。

2. 実行タイミング

- タスクが終了すると、イベントループは マイクロタスクキュー にあるすべてのマイクロタスクを実行してから次のタスクに移る。
- つまり、マイクロタスクは「現在のタスクが終わった直後」に実行される。

## 以下のコードを実行すると何が出力されるか予想し実際に確認しなさい。(「マイクロタスク」を使って)

### 予想

1 秒後に "Hello, world!" を表示するはず

### 実行結果

```
A
B
A
B
...
```

longA と longB の無限ループ内で毎回 await Promise.resolve({}) が実行されるため、マイクロタスクが連続して発生し、イベントループが setTimeout のタスクに到達できない。

### 理由

無限ループでマイクロタスクを作り続け → CPUずっと働く → 他の処理に進めない

(もう少し細かく言うと)

- Promise.resolve().then(...) は マイクロタスク を作成する。

- マイクロタスクは「現在のタスクが終了した直後にすべて実行される」性質を持つ。

- longA と longB のループは常に新しいマイクロタスクを追加し続けるため、イベントループが次のタスク（setTimeout）に進めない。(CPU使いすぎて？)

- そのため "Hello, world!" は表示されず、A と B のログだけがひたすら出力される。
